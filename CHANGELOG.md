<!--
SPDX-FileCopyrightText: 2024 Mathieu Fenniak <mathieu@fenniak.net>

SPDX-License-Identifier: GPL-3.0-or-later
-->

# testtrim Changelog

testtrim is an intelligent test selection tool which uses code coverage data, system call tracing, git change analysis, and a historical database in order to identify the minimum set of tests required to verify a commit is regression-free.

All notable changes to this project will be documented in this file.  This file is automatically generated from git commit logs using [git-cliff](https://git-cliff.org).

## [0.6.0] - 2024-12-26

### 🚀 Features

- *(strace)* Capture traffic on port 53 for DNS resolution ([#207](https://codeberg.org/testtrim/testtrim/issues/207))

### 🚜 Refactor

- Rebuild strace parsing and data mgmt ([#202](https://codeberg.org/testtrim/testtrim/issues/202))

### ⚙️ Miscellaneous Tasks

- Prevent release if no changes since last release ([#205](https://codeberg.org/testtrim/testtrim/issues/205))

## [0.5.0] - 2024-12-23

### 🚀 Features

- Monitor DNS resolution (via nscd) and expose hostname-based filters to network-policy ([#195](https://codeberg.org/testtrim/testtrim/issues/195))

### 🐛 Bug Fixes

- Perf stats reporting very low numbers for run-test ([#192](https://codeberg.org/testtrim/testtrim/issues/192))

## [0.4.1] - 2024-12-21

### 🐛 Bug Fixes

- *(network-policy)* Fix port-range limitations and add support for IPv4-mapped IPv6 address matching ([#190](https://codeberg.org/testtrim/testtrim/issues/190))
- *(network-policy)* Add wildcard support for unix sockets ([#191](https://codeberg.org/testtrim/testtrim/issues/191))

## [0.4.0] - 2024-12-21

### 🚀 Features

- Exit process w/ code representing success or failure ([#185](https://codeberg.org/testtrim/testtrim/issues/185))
- Network access policies for selective test execution ([#188](https://codeberg.org/testtrim/testtrim/issues/188))

### 🐛 Bug Fixes

- *(deps)* Update rust crate thiserror to v2 ([#175](https://codeberg.org/testtrim/testtrim/issues/175))
- *(deps)* Update rust crate clap-verbosity-flag to v3.0.2 ([#174](https://codeberg.org/testtrim/testtrim/issues/174))
- Add context to subcommand start errors to better report tooling problems ([#179](https://codeberg.org/testtrim/testtrim/issues/179))
- Restore performance stats, broken by async changes ([#186](https://codeberg.org/testtrim/testtrim/issues/186))
- Filter out network connections to port 0 from strace output ([#189](https://codeberg.org/testtrim/testtrim/issues/189))

### 🚜 Refactor

- Update CoverageDatabase to not take &mut self ([#178](https://codeberg.org/testtrim/testtrim/issues/178))
- Lift logic for network->test-case out of each test platform ([#187](https://codeberg.org/testtrim/testtrim/issues/187))

### 🧪 Testing

- Allow unit tests to run against separate DB than TESTTRIM_DATABASE_URL ([#176](https://codeberg.org/testtrim/testtrim/issues/176))
- Fix intermittent integration test failure caused by split DB logic ([#180](https://codeberg.org/testtrim/testtrim/issues/180))
- Use IPC-aware locking in postgres_sqlx ([#183](https://codeberg.org/testtrim/testtrim/issues/183))

### ⚙️ Miscellaneous Tasks

- Set deps to current specific versions ([#173](https://codeberg.org/testtrim/testtrim/issues/173))
- *(renovate)* Set all renovate PRs to 'chore' commit type ([#177](https://codeberg.org/testtrim/testtrim/issues/177))

## [0.3.3] - 2024-12-18

### 🐛 Bug Fixes

- *(deps)* Update rust crate thiserror to v2.0.8 ([#164](https://codeberg.org/testtrim/testtrim/issues/164))

### 📚 Documentation

- Cleanup duplicate content in CHANGELOG.md ([#159](https://codeberg.org/testtrim/testtrim/issues/159))

### ⚙️ Miscellaneous Tasks

- Fix intermittent /homeless-shelter build failure ([#162](https://codeberg.org/testtrim/testtrim/issues/162))
- Remove unused package in rust-check.yaml ([#165](https://codeberg.org/testtrim/testtrim/issues/165))
- Check-in .sqlx files, rather than always generating at build-time ([#169](https://codeberg.org/testtrim/testtrim/issues/169))
- Workaround DNS resolution errors in release.yaml Action ([#171](https://codeberg.org/testtrim/testtrim/issues/171))
- Fix bug with git-cliff not running after recent dedup fix ([#172](https://codeberg.org/testtrim/testtrim/issues/172))

## [0.3.2] - 2024-12-18

### 🐛 Bug Fixes

- Increase default actix-web JSON payload limit from 2MB, fixing 413 HTTP error on uploads ([#153](https://codeberg.org/testtrim/testtrim/issues/153))

### 🚜 Refactor

- Replace threadpool in run_tests w/ a tokio JoinSet ([#152](https://codeberg.org/testtrim/testtrim/issues/152))

### ⚡ Performance

- Use zstd compression saving coverage DB over API ([#156](https://codeberg.org/testtrim/testtrim/issues/156))
- Server-side support for response content compression ([#157](https://codeberg.org/testtrim/testtrim/issues/157))

### ⚙️ Miscellaneous Tasks

- Try to prevent double rust-check builds on new tags ([#150](https://codeberg.org/testtrim/testtrim/issues/150))
- Fix todo which will crash during failed golang test case ([#151](https://codeberg.org/testtrim/testtrim/issues/151))

## [0.3.1] - 2024-12-16

### 🐛 Bug Fixes

- OCI container not usable for network service without listening on 0.0.0.0 ([#149](https://codeberg.org/testtrim/testtrim/issues/149))

### 🚜 Refactor

- Update CoverageDatabase & web handlers to be async ([#147](https://codeberg.org/testtrim/testtrim/issues/147))

### ⚙️ Miscellaneous Tasks

- Fix warning caused by Cargo lockfile update; async_closure is now stable ([#148](https://codeberg.org/testtrim/testtrim/issues/148))

## [0.3.0] - 2024-12-16

### 🚀 Features

- Add an OCI container published for each release for testtrim run-server ([#144](https://codeberg.org/testtrim/testtrim/issues/144))

### 📚 Documentation

- README updates, re: coverage databases and scope ([#145](https://codeberg.org/testtrim/testtrim/issues/145))

## [0.2.1] - 2024-12-15

### 🐛 Bug Fixes

- *(go)* Fix failure when reading deleted file in guess_tests_from_test_file_changed ([#140](https://codeberg.org/testtrim/testtrim/issues/140))

### ⚙️ Miscellaneous Tasks

- *(release)* Release tagging and changelog generation ([#141](https://codeberg.org/testtrim/testtrim/issues/141))

## [0.2.0] - 2024-12-13

First tagged release; Rust & Go support

testtrim is an intelligent test selection tool which uses code coverage data, system call tracing, git change analysis, and a historical database in order to identify the minimum set of tests required to verify a commit is regression-free.

testtrim has enough support and capabilities to allow it to be used with some moderate sized Open Source Rust and Go projects with reasonable success and functionality, but it is certainly not fully feature complete, bug-free, flawless, or capable of working on every project.  This initial release isn't a guarantee of wide applicability; it's just a step towards providing distributible binaries so that integrations with continuous delivery systems can be performed.

The below release notes are a comprehensive set of all changes that were involved in the initial development and release of testtrim.  Future release notes will be more focused.

### 🚀 Features

- Read lcov files and compute stats
- Output TSV per-file
- Commit-based analysis tool
- Print-stats command can take coverage directory or tar.bz2 archive
- First pass at analyze-tests poc command
- Support .7z files in analyze-tests
- Add forgejo check for unit tests and warning-free build ([#1](https://codeberg.org/testtrim/testtrim/issues/1))
- Most basic test prediction w/ e2e test ([#3](https://codeberg.org/testtrim/testtrim/issues/3))
- Externally usable CLI commands ([#11](https://codeberg.org/testtrim/testtrim/issues/11))
- Remove git infinite lookback on new commits ([#19](https://codeberg.org/testtrim/testtrim/issues/19))
- Don't save coverage map when working on dirty source trees ([#38](https://codeberg.org/testtrim/testtrim/issues/38))
- Track Cargo dependency changes and affected tests ([#40](https://codeberg.org/testtrim/testtrim/issues/40))
- Simulate-history subcommand to evaluate testtrim effectiveness ([#12](https://codeberg.org/testtrim/testtrim/issues/12))
- Basic parallel execution of tests ([#25](https://codeberg.org/testtrim/testtrim/issues/25))
- Display test output on failures ([#29](https://codeberg.org/testtrim/testtrim/issues/29))
- Output test failure count during simulate-history ([#31](https://codeberg.org/testtrim/testtrim/issues/31))
- Track access to non-source-code files during test runs ([#34](https://codeberg.org/testtrim/testtrim/issues/34))
- Support include!, include_str!, include_bytes! for local file tests ([#36](https://codeberg.org/testtrim/testtrim/issues/36))
- Track working directory during strace tracing ([#46](https://codeberg.org/testtrim/testtrim/issues/46))
- Coverage database backed on PostgreSQL ([#58](https://codeberg.org/testtrim/testtrim/issues/58))
- Store coverage data separately for any touched project ([#66](https://codeberg.org/testtrim/testtrim/issues/66))
- Independent coverage maps for different "tags" on test runs ([#75](https://codeberg.org/testtrim/testtrim/issues/75))
- Trace tests that use network access ([#78](https://codeberg.org/testtrim/testtrim/issues/78))
- Transparency into why a test will/would be re-run ([#79](https://codeberg.org/testtrim/testtrim/issues/79))
- Very basic support for .NET projects ([#80](https://codeberg.org/testtrim/testtrim/issues/80))
- Add a service host for sharing testtrim data remotely ([#104](https://codeberg.org/testtrim/testtrim/issues/104))
- Fixup new HTTP API to use somewhat reasonably web semantics ([#116](https://codeberg.org/testtrim/testtrim/issues/116))
- Add Golang platform support (basic) ([#123](https://codeberg.org/testtrim/testtrim/issues/123))
- External package dependency tracking for Go ([#128](https://codeberg.org/testtrim/testtrim/issues/128))
- Implement syscall tracing for Go ([#131](https://codeberg.org/testtrim/testtrim/issues/131))
- Support //go:embed in go files ([#134](https://codeberg.org/testtrim/testtrim/issues/134))
- Go parallelism and network tracing ([#138](https://codeberg.org/testtrim/testtrim/issues/138))

### 🐛 Bug Fixes

- Grep has non-zero exit code with no hits, aborting script
- Proper reference to all binaries during lcov export
- Avoid div-by-zero in stats
- Switch script from bz2 to 7z for speed
- Fix scripts for changee to work off profraw data
- Keep all paths as Path/PathBuf in-memory rather than forcing to strings
- Use nix cache in actions to reduce build time ([#4](https://codeberg.org/testtrim/testtrim/issues/4))
- Name project testtrim ([#5](https://codeberg.org/testtrim/testtrim/issues/5))
- Rustfmt ([#7](https://codeberg.org/testtrim/testtrim/issues/7))
- Ensure rustfmt is run consistently on all pulls ([#8](https://codeberg.org/testtrim/testtrim/issues/8))
- Support removing a test case in a new commit ([#9](https://codeberg.org/testtrim/testtrim/issues/9))
- Use same codepath for base commit in e2e test ([#10](https://codeberg.org/testtrim/testtrim/issues/10))
- Update e2e tests to use CLI interfaces & DB storage ([#14](https://codeberg.org/testtrim/testtrim/issues/14))
- Temporary(?) console output for tests ran stats ([#16](https://codeberg.org/testtrim/testtrim/issues/16))
- Populate last_read_timestamp for future GC ([#21](https://codeberg.org/testtrim/testtrim/issues/21))
- *(performance)* If coverage DB is empty don't search all git commits ([#28](https://codeberg.org/testtrim/testtrim/issues/28))
- Set working-dir to match cargo test ([#29](https://codeberg.org/testtrim/testtrim/issues/29))
- Use manifest_path for root, rather than src_path ([#30](https://codeberg.org/testtrim/testtrim/issues/30))
- Chunk db inserts to avoid sqlite too many parameters errors ([#31](https://codeberg.org/testtrim/testtrim/issues/31))
- Missing DB instrumentation on save/is-empty DB operations ([#35](https://codeberg.org/testtrim/testtrim/issues/35))
- Don't pollute working dir with `cargo test` cmd profiling data ([#44](https://codeberg.org/testtrim/testtrim/issues/44))
- *(performance)* Improve perf of save_coverage_data ([#19](https://codeberg.org/testtrim/testtrim/issues/19))
- *(performance)* Improve perf of parse-test-data section ([#20](https://codeberg.org/testtrim/testtrim/issues/20))
- Break out of external dependency file detection earlier ([#21](https://codeberg.org/testtrim/testtrim/issues/21))
- Don't skip relevant instrumentation points ([#23](https://codeberg.org/testtrim/testtrim/issues/23))
- Coverage data mix-and-match between executables must be prevented due to identifier conflicts ([#24](https://codeberg.org/testtrim/testtrim/issues/24))
- Normalize file paths from syscall tracing ([#38](https://codeberg.org/testtrim/testtrim/issues/38))
- Add run test errors to format str ([#45](https://codeberg.org/testtrim/testtrim/issues/45))
- Support for multiline include statements ([#47](https://codeberg.org/testtrim/testtrim/issues/47))
- Cleanup usage of DATABASE_URL and SQLite storage locations ([#61](https://codeberg.org/testtrim/testtrim/issues/61))
- Wait in CI for pgsql to be up ([#64](https://codeberg.org/testtrim/testtrim/issues/64))
- Syntax fix in yaml ([#65](https://codeberg.org/testtrim/testtrim/issues/65))
- Repair multiproject failures ([#67](https://codeberg.org/testtrim/testtrim/issues/67))
- Conditionally compile strace module ([#76](https://codeberg.org/testtrim/testtrim/issues/76))
- Repair build in non-Unix platforms due to dependency on unix::net::SocketAddr ([#81](https://codeberg.org/testtrim/testtrim/issues/81))
- Go unable to build tests in a project with two packages having the same name ([#135](https://codeberg.org/testtrim/testtrim/issues/135))

### 🚜 Refactor

- Split coverage map data structure into separate module
- Move calculate_statistics into coverage_map.rs
- Split git & db functions out of lib.rs ([#13](https://codeberg.org/testtrim/testtrim/issues/13))
- Get_previous_commits returns iterator ([#15](https://codeberg.org/testtrim/testtrim/issues/15))
- Wrap git ops in an Scm trait ([#17](https://codeberg.org/testtrim/testtrim/issues/17))
- Eliminate git look-back for "new" tests ([#18](https://codeberg.org/testtrim/testtrim/issues/18))
- Denormalized coverage map without data duplication ([#33](https://codeberg.org/testtrim/testtrim/issues/33))
- Improve db.rs code ([#46](https://codeberg.org/testtrim/testtrim/issues/46))
- Move scm & rust-specific logic into submodules ([#47](https://codeberg.org/testtrim/testtrim/issues/47))
- Merge required trait bounds onto identifier types ([#48](https://codeberg.org/testtrim/testtrim/issues/48))
- Collection of random refactorings ([#39](https://codeberg.org/testtrim/testtrim/issues/39))
- Enable clippy::pedantic (with some exceptions) ([#41](https://codeberg.org/testtrim/testtrim/issues/41))
- Run clippy on test code ([#48](https://codeberg.org/testtrim/testtrim/issues/48))
- Cleanup strace a bit with match destructuring ([#49](https://codeberg.org/testtrim/testtrim/issues/49))
- Move coverage data storage into "coverage" submodule ([#57](https://codeberg.org/testtrim/testtrim/issues/57))
- Clap parser FIXMEs ([#69](https://codeberg.org/testtrim/testtrim/issues/69))
- Address fixme re: ScmCommit ([#70](https://codeberg.org/testtrim/testtrim/issues/70))
- Use cargo nextest run to run tests ([#77](https://codeberg.org/testtrim/testtrim/issues/77))

### 📚 Documentation

- Fix comment references to Gitea ([#2](https://codeberg.org/testtrim/testtrim/issues/2))
- Add README based upon intro blog post ([#49](https://codeberg.org/testtrim/testtrim/issues/49))
- Update README w/ refreshed test results ([#28](https://codeberg.org/testtrim/testtrim/issues/28))
- Add some notes to README about new capabilities ([#35](https://codeberg.org/testtrim/testtrim/issues/35))
- README updates ([#55](https://codeberg.org/testtrim/testtrim/issues/55))

### ⚙️ Miscellaneous Tasks

- Move src hosting from forgejo.kainnef.com to codeberg.org ([#1](https://codeberg.org/testtrim/testtrim/issues/1))
- Add copyright and license notices ([#10](https://codeberg.org/testtrim/testtrim/issues/10))
- Development version updates ([#11](https://codeberg.org/testtrim/testtrim/issues/11))
- Add rust-coverage-specimen check-14 and check-15 ([#51](https://codeberg.org/testtrim/testtrim/issues/51))
- Dependency & env updates ([#68](https://codeberg.org/testtrim/testtrim/issues/68))
- Fix renovate config missing SPDX identifiers ([#86](https://codeberg.org/testtrim/testtrim/issues/86))
- Tweak renovate settings ([#90](https://codeberg.org/testtrim/testtrim/issues/90))
- Refactor and cleanup web api code ([#117](https://codeberg.org/testtrim/testtrim/issues/117))

### Cleanup

- Remove fixmes that are done ([#12](https://codeberg.org/testtrim/testtrim/issues/12))

<!-- generated by git-cliff -->
